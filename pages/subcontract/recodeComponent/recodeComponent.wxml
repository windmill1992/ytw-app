<view class="recodeComMask" catchtap="true" catchtouchmove="true" wx:if="{{showRecodeCom}}">
  <view class="recodeComBox" style="padding-bottom:{{ slots == true ? '250rpx' : '80rpx' }};padding-top:{{ isNormal ? '50' : '15rpx' }};">
    <view class="recodeTop" wx:if="{{ isNormal }}">
      <view class="recodeComTitle">{{data1.manufactor_name}}<van-icon name="edit" style="vertical-align:middle;margin-left:2px;" color="#fff" size="50rpx" wx:if="{{ admin }}" catchtap="modifyFacName" /></view>
    </view>
    <scroll-view scroll-y="true" class="recodeScroll">
      <view class="ecodeComAppoint" wx:if="{{ isNormal }}"><!--预约记录-->
        <view class="recodeItemTitle" style="color:#18c2ba;">预约记录</view>
        <view class="recodeItemHead">
          <text>时间</text>
          <text>厂名</text>
          <text>预约数量</text>
        </view>
        <view class="recodeItemBody" wx:for="{{ data1.reservation }}" wx:key="index">
          <view>
            <view class="recodeTimeAbs">{{ m1.brTime(item.create_time,'a') }}</view>
            <view>{{ m1.brTime(item.create_time,'b') }}</view>
          </view>
          <view style="color:{{ (index>0&&(item.manufactor_name!=data.reservation[index-1].manufactor_name)) ? '#f10215' : '#555' }};">{{ (index>0&&(item.manufactor_name!=data1.reservation[index-1].manufactor_name) ) ? '改为' : '' }}{{ item.manufactor_name }}</view>
          <view style="color:{{ (index>0&&(item.num!=data.reservation[index-1].num)) ? '#f10215' : '#555' }};font-size:{{ item.num == '拼包中心添加' ? '20rpx' : '28rpx' }};line-height:65rpx;">{{ (index>0&&(item.num!=data1.reservation[index-1].num) && item.num != '拼包中心添加') ? '改为' : '' }}{{ item.num }}{{ (item.num == '拼包中心添加' || item.num == '未填') ? '' : '手' }}</view>
        </view>
        <!-- <view wx:if="{{ data.reservation.length>0 }}">
          <view></view>
          <view></view>
          <view class="recodeAllSum">合计：{{ m1.getSum(data.reservation) }}手</view>
        </view> -->
        <view class="recodeEmpty" wx:if="{{ data1.reservation.length == 0 }}">暂无相关记录~</view>
      </view>
      <view class="ecodeComAppoint" wx:if="{{ isNormal && data1.receiving.length > 0 }}" style="background-color:#e7f9f8;"><!--收货记录-->
        <view class="recodeItemTitle" style="color:#b5b9f9;">收货记录</view>
        <view class="recodeItemHead">
          <text>时间</text>
          <text>收货方式</text>
          <text>收货数量</text>
        </view>
        <view class="recodeItemBody" wx:for="{{ data1.receiving }}" wx:key="index" wx:if="{{ item.num > 0 }}">
          <view>
            <view class="recodeTimeAbs">{{ m1.brTime(item.create_time,'a') }}</view>
            <view>{{ m1.brTime(item.create_time,'b') }}</view>
          </view>
          <view style="color:{{ item.type == 1 ? '#999' : 'f10215' }};">
            <view><text style="color:{{m1.setReceiveColor(item.receive_type)}};">{{ item.text || '正常收货' }}</text></view>
            <view><text space="ensp" class="adminName">{{ item.admin_name + ' ' }}</text></view>
          </view>
          <view style="line-height:65rpx;"><text style="color:{{ (item.receive_type == 2 || item.receive_type == 3) ? '#f10260' : '' }};">{{ (item.receive_type == 2 || item.receive_type == 3) ? '-' : '+' }}{{ item.num }}手</text><van-icon name="edit" style="vertical-align:middle;" color="#18c2ba" size="50rpx" wx:if="{{ admin && item.receive_type != 3 && item.receive_type != 4 }}" catchtap="modifyItem" data-info="{{ item }}" data-type="receiving" /></view>
        </view>
        <view wx:if="{{ data1.receiving.length>0 }}">
          <view></view>
          <view></view>
          <view class="recodeAllSum">合计：{{ data1.receive_num }}手</view>
        </view>
        <view class="recodeEmpty" wx:if="{{ data1.receiving.length == 0 }}">暂无相关记录~</view>
      </view>
      <view class="ecodeComAppoint" wx:if="{{ isNormal && data1.packing.length > 0 }}" style="background-color:#e7f9f8;"><!--打包记录-->
        <view class="recodeItemTitle" style="color:#f9c174;">打包记录</view>
        <view class="recodeItemHead">
          <text>时间</text>
          <text>操作员</text>
          <text>打包数量</text>
        </view>
        <view class="recodeItemBody" wx:for="{{ data1.packing }}" wx:key="index" wx:if="{{ item.num > 0 }}">
          <view>
            <view class="recodeTimeAbs">{{ m1.brTime(item.create_time,'a') }}</view>
            <view>{{ m1.brTime(item.create_time,'b') }}</view>
          </view>
          <view>{{ item.admin_name }}</view>
          <view style="line-height:65rpx;">{{ item.num }}手<van-icon name="edit" color="#18c2ba" size="50rpx" wx:if="{{ admin }}" style="vertical-align:middle;" catchtap="modifyItem" data-info="{{ item }}" data-type="packing" /></view>
        </view>
        <view wx:if="{{ data1.packing.length>0 }}">
          <view></view>
          <view></view>
          <view class="recodeAllSum">合计：{{ data1.packing_num }}手</view>
        </view>
        <view class="recodeEmpty" wx:if="{{ data1.packing.length == 0 }}">暂无相关记录~</view>
      </view>
      <view class="ecodeComAppoint" wx:if="{{ isNormal && data1.take_away.length > 0 }}" style="background-color:#e7f9f8;"><!--拉包 记录-->
        <view class="recodeItemTitle" style="color:#6eb6ff;">拉包明细</view>
        <view class="recodeItemHead">
          <text>时间</text>
          <text>操作员</text>
          <text>拉包数量</text>
        </view>
        <view class="recodeItemBody" wx:for="{{ data1.take_away }}" wx:key="index" wx:if="{{ item.num > 0 }}">
          <view>
            <view class="recodeTimeAbs">{{ m1.brTime(item.create_date,'a') }}</view>
            <view>{{ m1.brTime(item.create_date,'b') }}</view>
          </view>
          <view>{{ item.admin_name }}</view>
          <view style="line-height:65rpx;">{{ item.num }}手<van-icon size="50rpx" name="edit" color="#18c2ba" style="vertical-align:middle;" wx:if="{{ false }}" catchtap="modifyItem" data-info="{{ item }}" data-type="take_away" /></view><!--  admin -->
        </view>
        <view wx:if="{{ data1.take_away.length>0 }}">
          <view></view>
          <view></view>
          <view class="recodeAllSum">合计：{{ data1.take_away_num }}手</view>
        </view>
        <view class="recodeEmpty" wx:if="{{ data1.take_away.length == 0 }}">暂无相关记录~</view>
      </view>
      <view wx:if="{{ !isNormal }}">
        <view class="historyAuditCom">
          <view class="col18c">历史审核记录</view>
          <view class="historyAuditComHead">
            <text>时间</text>
            <text>厂名</text>
            <text>数量</text>
            <text>状态</text>
          </view>
          <view class="historyAuditComBody" wx:for="{{ data1.history }}" wx:key="index">
            <view style="line-height:30rpx;">
              <view>{{m1.brTime(item.date,'a')}}</view>
              <view>{{m1.brTime(item.date,'b')}}</view>
            </view>
            <view>{{item.manufactor_name}}</view>
            <view>{{item.num}}手</view>
            <view>
              <van-radio-group wx:if="{{ item.status == 1 }}" value="1"><van-radio custom-class="absRadio" checked-color="#18c2ba" name="1"></van-radio></van-radio-group>
              <van-icon wx:if="{{ item.status == 2 }}" color="#f10215" style="margin-top:10rpx;" name="clear" size="38rpx" />
            </view>
          </view>
          <view class="recodeEmpty" wx:if="{{ data1.history.length == 0 }}">暂无相关记录~</view>
        </view>
        <view class="newAuditCom">
          <view class="col18c">新增厂家待审核</view>
          <view class="colee9397">最晚封包时间：{{ data1.appointment_time }}</view>
          <view class="historyAuditComBody" wx:for="{{ data1.audit }}" wx:key="index" style="background-color:{{item.lj?'#18c2ba':'#fff'}};color:{{ item.lj? '#fff' : '#333' }};" catchtap="clickNewAudit" data-index="{{ index }}" data-info="{{ item }}">
            <view style="line-height:30rpx;">
              <view>{{m1.brTime(item.create_date,'a')}}</view>
              <view>{{m1.brTime(item.create_date,'b')}}</view>
            </view>
            <view>{{item.manufactor_name}}</view>
            <view>{{item.num}}手</view>
            <view>
              <van-radio-group wx:if="{{ item.lj }}" value="1"><van-radio custom-class="absRadio" checked-color="#18c2ba" name="1"></van-radio></van-radio-group>
              <van-radio-group wx:if="{{ !item.lj }}" value="1"><van-radio custom-class="absRadio" checked-color="#ccc" name="1"></van-radio></van-radio-group>
            </view>
          </view>
          <view class="recodeEmpty" wx:if="{{ data1.audit.length == 0 }}">暂无新增待审核~</view>
        </view>
      </view>
    </scroll-view>
    <slot name="receiveSlot" wx:if="{{ slots }}"></slot>
    <slot name="auditSlot"></slot>
  </view>
  <view class="closeRecodeCom" catchtap="closeRecodeCom">X</view>
 
</view>
<wxs module="m1">
	var brTime = function(t,type){
			var t = t.split(' ')
			return type == 'a' ? t[0] : t[1]
  }
  var getSum = function(data){
			if (data.length > 0) {
        if (data.length == 1) {
          return data[0].num
        } else {
          var num = 0
          data.forEach(function(item){
            num+= (item.num - 0)
          })
          return num
        }
      }
  }
  var setReceiveColor = function(i){
	if (i==0 || i == 1) {
      return "#999"
  } else if(i==2){
      return "#f10260"
  } else if(i==3) {
      return "#f10260"
  } else if(i==4) {
		return "#f10260"
	}
}
  module.exports.brTime = brTime;
  module.exports.getSum = getSum;
  module.exports.setReceiveColor = setReceiveColor;
</wxs>